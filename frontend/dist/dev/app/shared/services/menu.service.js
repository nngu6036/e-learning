"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
require("rxjs/add/operator/mergeMap");
var auth_service_1 = require("./auth.service");
var _ = require("underscore");
var MenuService = (function () {
    function MenuService(authService) {
        this.authService = authService;
        this.ADMIN_MENU = [
            { label: 'Dashboard', icon: 'dashboard', routerLink: ['/dashboard'], code: 'DASHBOARD' },
            { label: '', separator: true, styleClass: 'menu-separator' },
            {
                label: 'Course', icon: 'school', code: 'SCHOOL',
                items: [
                    { label: 'Course', routerLink: ['/course/courses'], code: 'SCHOOL-COURSE' },
                    { label: 'Enrollment', routerLink: ['/course/enrollment'], code: 'SCHOOL-ENROLLMENT' },
                    { label: 'Course group', routerLink: ['/course/groups'], code: 'SCHOOL-GROUP' },
                ]
            },
            {
                label: 'Assessment', icon: 'grade', code: 'ASSESSMENT',
                items: [
                    { label: 'Question banks', routerLink: ['/assessment/questions'], code: 'ASSESSMENT-QUESTION' },
                    { label: 'Question category', routerLink: ['/assessment/groups'], code: 'ASSESSMENT-QUESTION_GROUP' },
                    { label: '', separator: true, styleClass: 'menu-separator' },
                    { label: 'Exams', routerLink: ['/assessment/exams'], code: 'ASSESSMENT-EXAMS' },
                    { label: 'Exam enrollments', routerLink: ['/assessment/exam-enrollments'], code: 'ASSESSMENT-EXAM_ENROLLMENTS' },
                    { label: 'Question sheet templates', routerLink: ['/assessment/question-sheets'], code: 'ASSESSMENT-QUESTION_SHEET' },
                    { label: '', separator: true, styleClass: 'menu-separator' },
                    { label: 'Surveys', routerLink: ['/assessment/surveys'], code: 'ASSESSMENT-SURVEYS' },
                    { label: 'Survey enrollments', routerLink: ['/assessment/survey-enrollments'], code: 'ASSESSMENT-SURVEY_ENROLLMENTS' },
                    { label: 'Survey sheet templates', routerLink: ['/assessment/survey-sheets'], code: 'ASSESSMENT-SURVEY_SHEET' },
                ]
            },
            {
                label: 'Competency', icon: 'linear_scale', code: 'COMPETENCY',
                items: [
                    { label: 'Competency', routerLink: ['/competency/list'], code: 'COMPETENCY-LIST' },
                    { label: 'Category', routerLink: ['/competency/groups'], code: 'COMPETENCY-GROUP' },
                    { label: 'Competency matrix', routerLink: ['/competency/matrix'], code: 'COMPETENCY-MATRIX' },
                ]
            },
            {
                label: 'Analysis', icon: 'pie_chart', code: 'ANALYSIS',
                items: [
                    { label: 'Report', routerLink: ['/analysis/reports'], code: 'ANALYSIS-REPORT' },
                    { label: 'Chart', routerLink: ['/analysis/charts'], code: 'ANALYSIS-CHART' },
                ]
            },
            {
                label: 'Workflow', icon: 'widgets', code: 'WORKFLOW',
                items: [
                    { label: 'Ticket', routerLink: ['/workflow/tickets'], code: 'WORKFLOW-TICKET' },
                    { label: 'Hierachy', routerLink: ['/workflow/hierachy'], code: 'WORKFLOW-TREE' }
                ]
            },
            {
                label: 'Accounts', icon: 'people', code: 'ACCOUNT',
                items: [
                    { label: 'User', routerLink: ['/account/users'], code: 'ACCOUNT-USER' },
                    { label: 'Group', routerLink: ['/account/groups'], code: 'ACCOUNT-USER_GROUP' },
                    { label: 'Permission', routerLink: ['/account/permissions'], code: 'ACCOUNT-PERMISSION' },
                ]
            },
            {
                label: 'Settings', icon: 'settings', code: 'SETTING',
            }
        ];
        this.USER_MENU = [
            { label: 'Dashboard', icon: 'dashboard', routerLink: ['/dashboard'] },
            { label: '', separator: true, styleClass: 'menu-separator' },
            { label: 'My courses', icon: 'school', routerLink: ['/lms/courses'] },
            { label: 'My exams', icon: 'alarm_add', routerLink: ['/lms/exams'] },
            { label: 'My surveys', icon: 'question_answer', routerLink: ['/lms/surveys'] },
            { label: 'My conference', icon: 'perm_phone_msg', routerLink: ['/lms/meetings'] },
            { label: '', separator: true, styleClass: 'menu-separator' },
            { label: 'Course search', icon: 'search', routerLink: ['/lms/courses/search'] },
            { label: 'Course recommend', icon: 'stars', routerLink: ['/lms/courses/recommend'] },
        ];
    }
    MenuService.prototype.menuToTree = function (menu) {
        var _this = this;
        var tree = [];
        _.each(menu, (function (menuItem) {
            if (!menuItem.separator) {
                var node = _this.convertMenuNodeToTreeNode(menuItem);
                node.expanded = true;
                tree.push(node);
            }
        }));
        return tree;
    };
    MenuService.prototype.findMenuTreeNode = function (tree, code) {
        for (var i = 0; i < tree.length; i++) {
            var node = this.findSubMenuTreeNode(tree[i], code);
            if (node)
                return node;
        }
        return null;
    };
    MenuService.prototype.findSubMenuTreeNode = function (node, code) {
        if (node["data"] == code)
            return node;
        for (var i = 0; i < node.children.length; i++) {
            var subNode = this.findSubMenuTreeNode(node.children[i], code);
            if (subNode)
                return subNode;
        }
    };
    MenuService.prototype.convertMenuNodeToTreeNode = function (menuItem) {
        var _this = this;
        var node = menuItem;
        node["data"] = menuItem["code"];
        node["children"] = [];
        _.each(menuItem.items, (function (menuSubItem) {
            if (!menuSubItem.separator) {
                var subNode = _this.convertMenuNodeToTreeNode(menuSubItem);
                node["children"].push(subNode);
            }
        }));
        return node;
    };
    MenuService.prototype.adminMenu = function () {
        var _this = this;
        if (this.authService.UserProfile.IsSuperAdmin)
            return this.ADMIN_MENU;
        var menuCodes = [];
        if (this.authService.UserPermission && this.authService.UserPermission.menu_access)
            menuCodes = JSON.parse(this.authService.UserPermission.menu_access);
        var menu = [];
        _.each(this.ADMIN_MENU, (function (menuItem) {
            var allow = _this.isAllowTowViewAdminMenu(menuItem, menuCodes);
            if (allow)
                menu.push(menuItem);
        }));
        return menu;
    };
    MenuService.prototype.isAllowTowViewAdminMenu = function (menuItem, menuCodes) {
        if (menuItem.separator || !menuItem["code"])
            return true;
        return _.contains(menuCodes, menuItem["code"]);
    };
    MenuService.prototype.userMenu = function () {
        return this.USER_MENU;
    };
    MenuService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [auth_service_1.AuthService])
    ], MenuService);
    return MenuService;
}());
exports.MenuService = MenuService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zaGFyZWQvc2VydmljZXMvbWVudS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsc0NBQTJDO0FBRTNDLHNDQUFvQztBQUtwQywrQ0FBNEM7QUFHNUMsOEJBQWdDO0FBR2hDO0lBNEVFLHFCQUFvQixXQUF3QjtRQUF4QixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQTFFbEMsZUFBVSxHQUFHO1lBQ1QsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUcsSUFBSSxFQUFDLFdBQVcsRUFBQztZQUN2RixFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsZ0JBQWdCLEVBQUU7WUFDNUQ7Z0JBQ0ksS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBQyxRQUFRO2dCQUM5QyxLQUFLLEVBQUU7b0JBQ0gsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsSUFBSSxFQUFDLGVBQWUsRUFBQztvQkFDekUsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBRSxDQUFDLG9CQUFvQixDQUFDLEVBQUUsSUFBSSxFQUFDLG1CQUFtQixFQUFDO29CQUNwRixFQUFFLEtBQUssRUFBRSxjQUFjLEVBQUUsVUFBVSxFQUFFLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxJQUFJLEVBQUMsY0FBYyxFQUFDO2lCQUNoRjthQUNKO1lBQ0Q7Z0JBQ0ksS0FBSyxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFDLElBQUksRUFBQyxZQUFZO2dCQUNwRCxLQUFLLEVBQUU7b0JBQ0gsRUFBRSxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVSxFQUFFLENBQUMsdUJBQXVCLENBQUMsRUFBQyxJQUFJLEVBQUMscUJB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QUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDdEUsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsVUFBQyxRQUFrQjtZQUMxQyxJQUFJLEtBQUssR0FBRyxLQUFJLENBQUMsdUJBQXVCLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQzlELElBQUksS0FBSztnQkFDUCxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDSixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCw2Q0FBdUIsR0FBdkIsVUFBd0IsUUFBUSxFQUFFLFNBQVM7UUFDekMsSUFBSSxRQUFRLENBQUMsU0FBUyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztZQUN6QyxPQUFPLElBQUksQ0FBQztRQUNkLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVELDhCQUFRLEdBQVI7UUFDRSxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEIsQ0FBQztJQWxKVSxXQUFXO1FBRHZCLGlCQUFVLEVBQUU7eUNBNkVzQiwwQkFBVztPQTVFakMsV0FBVyxDQW9KdkI7SUFBRCxrQkFBQztDQXBKRCxBQW9KQyxJQUFBO0FBcEpZLGtDQUFXIiwiZmlsZSI6ImFwcC9zaGFyZWQvc2VydmljZXMvbWVudS5zZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMvUngnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9tZXJnZU1hcCc7XG5pbXBvcnQgeyBDcmVkZW50aWFsIH0gZnJvbSAnLi4vbW9kZWxzL2NyZWRlbnRpYWwubW9kZWwnO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4uL21vZGVscy9lbGVhcm5pbmcvdXNlci5tb2RlbCc7XG5pbXBvcnQgeyBUb2tlbiB9IGZyb20gJy4uL21vZGVscy9jbG91ZC90b2tlbi5tb2RlbCc7XG5pbXBvcnQgeyBNYXBVdGlscyB9IGZyb20gJy4uL2hlbHBlcnMvbWFwLnV0aWxzJztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi9hdXRoLnNlcnZpY2UnXG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBNZW51SXRlbSB9IGZyb20gJ3ByaW1lbmcvcHJpbWVuZyc7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ3VuZGVyc2NvcmUnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTWVudVNlcnZpY2Uge1xuXG4gICAgcHJpdmF0ZSBBRE1JTl9NRU5VID0gW1xuICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdEYXNoYm9hcmQnLCBpY29uOiAnZGFzaGJvYXJkJywgcm91dGVyTGluazogWycvZGFzaGJvYXJkJ10gLCBjb2RlOidEQVNIQk9BUkQnfSxcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnJywgc2VwYXJhdG9yOiB0cnVlLCBzdHlsZUNsYXNzOiAnbWVudS1zZXBhcmF0b3InIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0NvdXJzZScsIGljb246ICdzY2hvb2wnLCBjb2RlOidTQ0hPT0wnLFxuICAgICAgICAgICAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJ0NvdXJzZScsIHJvdXRlckxpbms6IFsnL2NvdXJzZS9jb3Vyc2VzJ10gLGNvZGU6J1NDSE9PTC1DT1VSU0UnfSwgXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGxhYmVsOiAnRW5yb2xsbWVudCcsIHJvdXRlckxpbms6IFsnL2NvdXJzZS9lbnJvbGxtZW50J10gLGNvZGU6J1NDSE9PTC1FTlJPTExNRU5UJ30sIFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJ0NvdXJzZSBncm91cCcsIHJvdXRlckxpbms6IFsnL2NvdXJzZS9ncm91cHMnXSAsY29kZTonU0NIT09MLUdST1VQJ30sXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBc3Nlc3NtZW50JywgaWNvbjogJ2dyYWRlJyxjb2RlOidBU1NFU1NNRU5UJyxcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdRdWVzdGlvbiBiYW5rcycsIHJvdXRlckxpbms6IFsnL2Fzc2Vzc21lbnQvcXVlc3Rpb25zJ10sY29kZTonQVNTRVNTTUVOVC1RVUVTVElPTicgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdRdWVzdGlvbiBjYXRlZ29yeScsIHJvdXRlckxpbms6IFsnL2Fzc2Vzc21lbnQvZ3JvdXBzJ10sY29kZTonQVNTRVNTTUVOVC1RVUVTVElPTl9HUk9VUCcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICcnLCBzZXBhcmF0b3I6IHRydWUsIHN0eWxlQ2xhc3M6ICdtZW51LXNlcGFyYXRvcicgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdFeGFtcycsIHJvdXRlckxpbms6IFsnL2Fzc2Vzc21lbnQvZXhhbXMnXSxjb2RlOidBU1NFU1NNRU5ULUVYQU1TJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJ0V4YW0gZW5yb2xsbWVudHMnLCByb3V0ZXJMaW5rOiBbJy9hc3Nlc3NtZW50L2V4YW0tZW5yb2xsbWVudHMnXSxjb2RlOidBU1NFU1NNRU5ULUVYQU1fRU5ST0xMTUVOVFMnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGxhYmVsOiAnUXVlc3Rpb24gc2hlZXQgdGVtcGxhdGVzJywgcm91dGVyTGluazogWycvYXNzZXNzbWVudC9xdWVzdGlvbi1zaGVldHMnXSxjb2RlOidBU1NFU1NNRU5ULVFVRVNUSU9OX1NIRUVUJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJycsIHNlcGFyYXRvcjogdHJ1ZSwgc3R5bGVDbGFzczogJ21lbnUtc2VwYXJhdG9yJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJ1N1cnZleXMnLCByb3V0ZXJMaW5rOiBbJy9hc3Nlc3NtZW50L3N1cnZleXMnXSxjb2RlOidBU1NFU1NNRU5ULVNVUlZFWVMnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGxhYmVsOiAnU3VydmV5IGVucm9sbG1lbnRzJywgcm91dGVyTGluazogWycvYXNzZXNzbWVudC9zdXJ2ZXktZW5yb2xsbWVudHMnXSxjb2RlOidBU1NFU1NNRU5ULVNVUlZFWV9FTlJPTExNRU5UUycgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdTdXJ2ZXkgc2hlZXQgdGVtcGxhdGVzJywgcm91dGVyTGluazogWycvYXNzZXNzbWVudC9zdXJ2ZXktc2hlZXRzJ10sY29kZTonQVNTRVNTTUVOVC1TVVJWRVlfU0hFRVQnIH0sXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdDb21wZXRlbmN5JywgaWNvbjogJ2xpbmVhcl9zY2FsZScsY29kZTonQ09NUEVURU5DWScsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGxhYmVsOiAnQ29tcGV0ZW5jeScsIHJvdXRlckxpbms6IFsnL2NvbXBldGVuY3kvbGlzdCddLGNvZGU6J0NPTVBFVEVOQ1ktTElTVCcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdDYXRlZ29yeScsIHJvdXRlckxpbms6IFsnL2NvbXBldGVuY3kvZ3JvdXBzJ10sY29kZTonQ09NUEVURU5DWS1HUk9VUCcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdDb21wZXRlbmN5IG1hdHJpeCcsIHJvdXRlckxpbms6IFsnL2NvbXBldGVuY3kvbWF0cml4J10gLGNvZGU6J0NPTVBFVEVOQ1ktTUFUUklYJ30sXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBbmFseXNpcycsIGljb246ICdwaWVfY2hhcnQnLGNvZGU6J0FOQUxZU0lTJyxcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdSZXBvcnQnLCByb3V0ZXJMaW5rOiBbJy9hbmFseXNpcy9yZXBvcnRzJ10sY29kZTonQU5BTFlTSVMtUkVQT1JUJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJ0NoYXJ0Jywgcm91dGVyTGluazogWycvYW5hbHlzaXMvY2hhcnRzJ10sY29kZTonQU5BTFlTSVMtQ0hBUlQnIH0sXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdXb3JrZmxvdycsIGljb246ICd3aWRnZXRzJyxjb2RlOidXT1JLRkxPVycsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7IGxhYmVsOiAnVGlja2V0Jywgcm91dGVyTGluazogWycvd29ya2Zsb3cvdGlja2V0cyddLGNvZGU6J1dPUktGTE9XLVRJQ0tFVCcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdIaWVyYWNoeScsIHJvdXRlckxpbms6IFsnL3dvcmtmbG93L2hpZXJhY2h5J10sY29kZTonV09SS0ZMT1ctVFJFRScgfVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQWNjb3VudHMnLCBpY29uOiAncGVvcGxlJyxjb2RlOidBQ0NPVU5UJyxcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdVc2VyJywgcm91dGVyTGluazogWycvYWNjb3VudC91c2VycyddLGNvZGU6J0FDQ09VTlQtVVNFUicgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdHcm91cCcsIHJvdXRlckxpbms6IFsnL2FjY291bnQvZ3JvdXBzJ10sY29kZTonQUNDT1VOVC1VU0VSX0dST1VQJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJ1Blcm1pc3Npb24nLCByb3V0ZXJMaW5rOiBbJy9hY2NvdW50L3Blcm1pc3Npb25zJ10sY29kZTonQUNDT1VOVC1QRVJNSVNTSU9OJyB9LFxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnU2V0dGluZ3MnLCBpY29uOiAnc2V0dGluZ3MnLGNvZGU6J1NFVFRJTkcnLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG5cbiAgICBwcml2YXRlIFVTRVJfTUVOVSA9IFtcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnRGFzaGJvYXJkJywgaWNvbjogJ2Rhc2hib2FyZCcsIHJvdXRlckxpbms6IFsnL2Rhc2hib2FyZCddIH0sXG4gICAgICAgICAgICAgICAgeyBsYWJlbDogJycsIHNlcGFyYXRvcjogdHJ1ZSwgc3R5bGVDbGFzczogJ21lbnUtc2VwYXJhdG9yJyB9LFxuICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdNeSBjb3Vyc2VzJywgaWNvbjogJ3NjaG9vbCcsIHJvdXRlckxpbms6IFsnL2xtcy9jb3Vyc2VzJ10gfSxcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnTXkgZXhhbXMnLCBpY29uOiAnYWxhcm1fYWRkJywgcm91dGVyTGluazogWycvbG1zL2V4YW1zJ10gfSxcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnTXkgc3VydmV5cycsIGljb246ICdxdWVzdGlvbl9hbnN3ZXInLCByb3V0ZXJMaW5rOiBbJy9sbXMvc3VydmV5cyddIH0sXG4gICAgICAgICAgICAgICAgeyBsYWJlbDogJ015IGNvbmZlcmVuY2UnLCBpY29uOiAncGVybV9waG9uZV9tc2cnLCByb3V0ZXJMaW5rOiBbJy9sbXMvbWVldGluZ3MnXSB9LFxuICAgICAgICAgICAgICAgICB7IGxhYmVsOiAnJywgc2VwYXJhdG9yOiB0cnVlLCBzdHlsZUNsYXNzOiAnbWVudS1zZXBhcmF0b3InIH0sXG4gICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdDb3Vyc2Ugc2VhcmNoJywgaWNvbjogJ3NlYXJjaCcsIHJvdXRlckxpbms6IFsnL2xtcy9jb3Vyc2VzL3NlYXJjaCddIH0sXG4gICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdDb3Vyc2UgcmVjb21tZW5kJywgaWNvbjogJ3N0YXJzJywgcm91dGVyTGluazogWycvbG1zL2NvdXJzZXMvcmVjb21tZW5kJ10gfSxcbiAgICAgICAgICAgIF07XG5cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdXRoU2VydmljZSkge1xuICB9XG5cbiAgbWVudVRvVHJlZShtZW51KSB7XG4gICAgdmFyIHRyZWUgPSBbXTtcbiAgICBfLmVhY2gobWVudSwgKChtZW51SXRlbTogTWVudUl0ZW0pID0+IHtcbiAgICAgIGlmICghbWVudUl0ZW0uc2VwYXJhdG9yKSB7XG4gICAgICAgIHZhciBub2RlID0gdGhpcy5jb252ZXJ0TWVudU5vZGVUb1RyZWVOb2RlKG1lbnVJdGVtKTtcbiAgICAgICAgbm9kZS5leHBhbmRlZCA9ICB0cnVlO1xuICAgICAgICB0cmVlLnB1c2gobm9kZSk7XG4gICAgICB9XG4gICAgfSkpO1xuICAgIHJldHVybiB0cmVlO1xuICB9XG5cbiAgZmluZE1lbnVUcmVlTm9kZSh0cmVlLCBjb2RlOiBzdHJpbmcpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyZWUubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBub2RlID0gdGhpcy5maW5kU3ViTWVudVRyZWVOb2RlKHRyZWVbaV0sIGNvZGUpO1xuICAgICAgaWYgKG5vZGUpXG4gICAgICAgIHJldHVybiBub2RlO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgZmluZFN1Yk1lbnVUcmVlTm9kZShub2RlLCBjb2RlOiBzdHJpbmcpIHtcbiAgICBpZiAobm9kZVtcImRhdGFcIl0gPT0gY29kZSlcbiAgICAgIHJldHVybiBub2RlO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHN1Yk5vZGUgPSB0aGlzLmZpbmRTdWJNZW51VHJlZU5vZGUobm9kZS5jaGlsZHJlbltpXSwgY29kZSk7XG4gICAgICBpZiAoc3ViTm9kZSlcbiAgICAgICAgcmV0dXJuIHN1Yk5vZGU7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjb252ZXJ0TWVudU5vZGVUb1RyZWVOb2RlKG1lbnVJdGVtKSB7XG4gICAgdmFyIG5vZGUgPSBtZW51SXRlbTtcbiAgICBub2RlW1wiZGF0YVwiXSA9IG1lbnVJdGVtW1wiY29kZVwiXTtcbiAgICBub2RlW1wiY2hpbGRyZW5cIl0gPSBbXTtcbiAgICBfLmVhY2gobWVudUl0ZW0uaXRlbXMsICgobWVudVN1Ykl0ZW06IE1lbnVJdGVtKSA9PiB7XG4gICAgICBpZiAoIW1lbnVTdWJJdGVtLnNlcGFyYXRvcikge1xuICAgICAgICB2YXIgc3ViTm9kZSA9IHRoaXMuY29udmVydE1lbnVOb2RlVG9UcmVlTm9kZShtZW51U3ViSXRlbSk7XG4gICAgICAgIG5vZGVbXCJjaGlsZHJlblwiXS5wdXNoKHN1Yk5vZGUpO1xuICAgICAgfVxuICAgIH0pKTtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIGFkbWluTWVudSgpIHtcbiAgICBpZiAodGhpcy5hdXRoU2VydmljZS5Vc2VyUHJvZmlsZS5Jc1N1cGVyQWRtaW4pXG4gICAgICByZXR1cm4gdGhpcy5BRE1JTl9NRU5VO1xuICAgIHZhciBtZW51Q29kZXMgPSBbXVxuICAgIGlmICh0aGlzLmF1dGhTZXJ2aWNlLlVzZXJQZXJtaXNzaW9uICYmIHRoaXMuYXV0aFNlcnZpY2UuVXNlclBlcm1pc3Npb24ubWVudV9hY2Nlc3MpXG4gICAgICBtZW51Q29kZXMgPSBKU09OLnBhcnNlKHRoaXMuYXV0aFNlcnZpY2UuVXNlclBlcm1pc3Npb24ubWVudV9hY2Nlc3MpO1xuICAgIHZhciBtZW51ID0gW107XG4gICAgXy5lYWNoKHRoaXMuQURNSU5fTUVOVSwgKChtZW51SXRlbTogTWVudUl0ZW0pID0+IHtcbiAgICAgIHZhciBhbGxvdyA9IHRoaXMuaXNBbGxvd1Rvd1ZpZXdBZG1pbk1lbnUobWVudUl0ZW0sIG1lbnVDb2Rlcyk7XG4gICAgICBpZiAoYWxsb3cpXG4gICAgICAgIG1lbnUucHVzaChtZW51SXRlbSk7XG4gICAgfSkpO1xuICAgIHJldHVybiBtZW51O1xuICB9XG5cbiAgaXNBbGxvd1Rvd1ZpZXdBZG1pbk1lbnUobWVudUl0ZW0sIG1lbnVDb2Rlcyk6IGJvb2xlYW4ge1xuICAgIGlmIChtZW51SXRlbS5zZXBhcmF0b3IgfHwgIW1lbnVJdGVtW1wiY29kZVwiXSlcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBfLmNvbnRhaW5zKG1lbnVDb2RlcywgbWVudUl0ZW1bXCJjb2RlXCJdKTtcbiAgfVxuXG4gIHVzZXJNZW51KCkge1xuICAgIHJldHVybiB0aGlzLlVTRVJfTUVOVTtcbiAgfVxuXG59XG4iXX0=
